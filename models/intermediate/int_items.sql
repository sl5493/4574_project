SELECT
    iv.ITEM_NAME,
    (iv.ADD_TO_CART_QUANTITY - iv.REMOVE_FROM_CART_QUANTITY) AS PURCHASED_NUMBER,
    SUM(iv.PRICE_PER_UNIT * (iv.ADD_TO_CART_QUANTITY - iv.REMOVE_FROM_CART_QUANTITY)) AS TOTAL_SOLD_PRICES,
    AVG(iv.PRICE_PER_UNIT) AS AVERAGE_PRICE_PER_UNIT
FROM {{ ref('base_snowflake__ITEM_VIEWS') }} AS iv
INNER JOIN {{ ref('base_snowflake__ORDERS') }} AS or1
    ON iv.SESSION_ID = or1.SESSION_ID
GROUP BY iv.ITEM_NAME, (iv.ADD_TO_CART_QUANTITY - iv.REMOVE_FROM_CART_QUANTITY)



